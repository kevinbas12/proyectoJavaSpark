<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Productos Especiales</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
</head>
<body style="background-color: beige;">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto d-flex justify-content-center w-100 font-weight-bold">
            <li class="nav-item active m-auto">
                <a class="nav-link" href="/">Inicio</a>
            </li>
            <li class="nav-item d-flex m-auto">
                <input id="consultarTodoEspecial" class="form-control" type="search" placeholder="Search" aria-label="Buscar">
                <button class="btn btn-outline-success ml-2" onclick="BuscarEspecial()">Buscar</button>
            </li>
            <li class="nav-item m-auto">

                <span class="btn btn-outline-light " onclick="RevisarEspecial()">Cerrar sesion</span>

            </li>
        </ul>
    </div>
</nav>
<br>
<div class="container">
    <div class="row">

        <h2 class="text-center text-italic col-md-8">Especial</h2>
        <p class="btn btn-outline-dark col-md-2 m-auto" onclick=AgregarVistaEspecial()>Agregar nuevo</p>
        <a class="btn btn-outline-dark col-md-2 m-auto" href="/especialEditar">Modificar</a>

    </div>
    <!--    Consultar-->



    <div class="row mt-4 font-weight-bold">
        <div class="col-md-2 ml-auto">Nombre</div>
        <div class="col-md-2">Juego</div>

        <div class="col-md-1">Precio</div>
        <div class="col-md-1 mr-auto">Revision</div>
        <div class="col-md-1">Modificar</div>
        <div class="col-md-1">Eliminar</div>

    </div>
    <section id="display"></section>

    <!--    modelo-->
    <div class="modal fade" id="modeloDisplay" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content text-center">
                <div class="modal-header">
                    <h5 class="modal-title ml-auto" id="modeloTitulo" > Especial</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <section id="modeloDisplay">
                        <p class="border">Producto Especial: <span id="displayNombreEspecial"></span></p>
                        <p class="border">Juego de Producto Especial: <span id="displayJuegoEspecial"></span></p>


                        <p class="border">Precio de Producto Especial: <span id="displayPrecioEspecial"></span></p>
                    </section>

                    <section id="modificarSiModelo">
                        <p>Nombre: <input type="text" id="especialNombre" class="form-control"></p>
                        <p>Juego de Producto: <input type="text" id="especialJuego" class="form-control"></p>

                        <p>Precio de producto Especial: <input type="text" id="especialPrecio" class="form-control"></p>


                        <p><button id="btnGuardar" class="btn btn-lg btn-outline-dark" data-id = "0" onclick="AceptarEspecial(this)">Guardar</button></p>
                        <p><button id="btnAceptar" class="btn btn-lg btn-outline-dark" data-id = "0" onclick="CambiarEspecial(this)">Aceptar</button></p>
                    </section>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="iniciosesion" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content text-center">
                <div class="modal-header">
                    <h5 class="modal-title ml-auto" id="modeloTitulo" >Inicio sesion</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <label for="userName">Ingrese nombre de usuario (admin)</label><br>
                    <input type="text" id="userName" class="form-control">
                    <label for="userName">Ingrese contrase√±a (admin)</label><br>
                    <input type="password" id="password" class="form-control"><br>
                    <button class="btn btn-outline-dark" onclick="Acceder()">Acceder</button>
                </div>
            </div>
        </div>
    </div>

</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script>

    function EliminarEspecial(id) {
        if(confirm("Quiere eliminar el producto especial agregado ?")){
            $.ajax({
                url:"/eliminarEspecial",
                method:"POST",
                dataType:"json",
                data:{"id":id},
                success: function (response) {
                    alert(response);
                    ActualizarTodoEspecial();
                }
            });
        }
    }
    function RevisarEspecial() {
        $.ajax({
            url:"/revisarEspecial",
            method:"POST",
            dataType:"json",
            success:function (response) {Especial.Filter(especialArrayList,"nombreEspecial",request.queryParams("nombreEspecial"));
                window.location.href = "/";
            }
        });
    }
    function AgregarVistaEspecial() {
        $('#modeloTitulo').html("Titulo");
        $('#modeloDisplay').css({"display":"none"});
        $('#modificarSiModelo').css({"display":"block"});
        let response = {"id":0,"nombreEspecial":" ","juegoEspecial":" ","precioEspecial":""};
        ModeloLlenarEspecial(response);
        $('#btnAceptar').css({"display":"none"});
        $('#btnGuardar').css({"display":"block"});
        $('#modeloDisplay').modal('show');
    }
    function EditarEspecial(id) {
        $.ajax({
            url:"/especial",
            method:"post",
            dataType:"json",
            data:{"id":id},
            success:function (response) {
                $('#modeloTitulo').html("Modificar Especial");
                $('#modeloDisplay').css({"display":"none"});
                $('#modificarSiModelo').css({"display":"block"});
                $('#btnAceptar').css({"display":"block"});
                $('#btnGuardar').css({"display":"none"});
                ModeloLlenarEspecial(response)
                document.querySelector("#btnAceptar").setAttribute("data-id",response.id);
                $('#modeloDisplay').modal('show');
            }
        })}
    function ModeloLlenarEspecial(response) {
        document.querySelector("#especialNombre").value = response.nombreEspecial;
        document.querySelector("#especialJuego").value = response.juegoEspecial;
        document.querySelector("#especialPrecio").value = response.precioEspecial;
    }
    function CambiarEspecial(el) {
        let data = AgregarDatosEspecial(el.getAttribute("data-id"));
        if(data==null){
            alert("Datos incorrectos");
            return;
        }
        $.ajax({
            url:"/cambiarEspecial",
            method:"POST",
            dataType:"json",
            data:data,
            success:function (response) {
                alert(response);
                ActualizarTodoEspecial();
            }
        })
    }
    function AceptarEspecial() {
        let data = AgregarDatosEspecial(0);
        if(data == null){
            alert("Datos incorrectos");
            return;
        }
        $.ajax({
            url:"/aceptarEspecial",
            method:"POST",
            dataType:"json",
            data:data,
            success:function (response) {
                alert(response);
                ActualizarTodoEspecial();
            }
        })
    }
    function AgregarDatosEspecial(id) {
        let data = {"id":id,"nombreEspecial":document.querySelector("#especialNombre").value,"juegoEspecial":document.querySelector("#especialJuego").value,
            "precioEspecial":document.querySelector("#especialPrecio").value};
        if(data.precioEspecial == "" || data.nombreEspecial == "" || data.juegoEspecial == "" || data.precioEspecial > 999999 ){
            data = null;
            return data;
        }

        return data;
    }

    function BuscarEspecial() {
        let detalle = document.querySelector("#consultarTodoEspecial").value;
        if(detalle==""){
            return;
        }
        $.ajax({
            url:"/buscarTodoEspecial",
            method:"POST",
            dataType:"json",
            data:{"detalle":detalle},
            success:function (response) {
                DisplayEspecial(response);
            }
        })
    }
    function ConsultarEspecial() {
        let nombreEspecial = document.querySelector("#especialNombre").value;
        let juegoEspecial = document.querySelector("#especialJuego").value;
        let precioEspecial = document.querySelector("#especialPrecio").value;
        let minC = Math.abs(Number.parseFloat(document.querySelector("#comprasRealizadasMin").value));
        let maxC = Math.abs(Number.parseFloat(document.querySelector("#comprasRealizadasMax").value));
        if(minC>maxC){
            let tmp = minC;
            minC = maxC;
            maxC = tmp;
        }
        document.querySelector("#precioMin").value = minC;
        document.querySelector("#precioMax").value = maxC;
        if(minC == "") minC = 0;
        if(maxC == "") maxC = 999999;
        console.log(nombreEspecial);
        console.log(juegoEspecial);

        console.log(minC);
        console.log(maxC);
        $.ajax({
            url:"/consultarEspecial",
            method:"POST",
            dataType:"json",
            data:{"nombreEspecial":nombreEspecial ,"direccionEspecial":juegoEspecial,"minC":minC,"maxC":maxC},
            success:function (response) {
                DisplayEspecial(response);
            }
        });
    }
    function RevisionEspecial(id) {
        $.ajax({
            url:"/especial",
            method:"post",
            dataType:"json",
            data:{"id":id},
            success:function (response) {
                $('#modeloTitulo').html("Revision");
                $('#modeloDisplay').css({"display":"block"});

                $('#modificarSiModelo').css({"display":"none"});

                console.log(response);
                document.querySelector("#especialNombre").innerHTML = response.nombreEspecial;
                document.querySelector("#especialJuego").innerHTML = response.juegoEspecial;
                document.querySelector("#especialPrecio").innerHTML = response.precioEspecial
                ModeloLlenarEspecial(response)
                $('#modeloDisplay').modal('show');

            }
        });
    }
    function DisplayEspecial(response) {
        let display = document.querySelector("#display");
        let txt = "";
        for(let i = 0;i<response.length;i++){
            txt+=`<div class="row border p-2">`;
            txt+=`<div class="col-md-2 ml-auto">${response[i].nombreEspecial}</div>`
            txt+=`<div class="col-md-2">${response[i].juegoEspecial}</div>`
            txt+=`<div class="col-md-2">${response[i].precioEspecial}</div>`
            txt+=`<div class="col-md-1 text-center mr-auto"><button class="btn btn-outline-dark" onclick="RevisionEspecial(${response[i].id})"><i class="fas fa-info-circle"></i></button></div>`

            txt+=`  <div class="col-md-1 text-center"><button class="btn btn-outline-dark" onclick="EditarEspecial(${response[i].id})"><i class="fas fa-cogs"></i></button></div>
                        <div class="col-md-1 text-center"><button class="btn btn-outline-dark" onclick="EliminarEspecial(${response[i].id})"><i class="fas fa-trash-alt"></i></button></div>`

            txt+=`</div>`;
        }
        display.innerHTML = txt;
    }
    function Acceder() {
        let name = document.querySelector("#userName").value;
        let password = document.querySelector("#password").value;
        $.ajax({
            url:"/acceder",
            method:"POST",
            dataType:"json",
            data:{"name":name,"password":password},
            success:function (response) {
                window.location.href = response;
            }
        });
    }
    function SeleccionarEspecial(response) {
        let nombreEspecial = document.querySelector("#especialNombre");
        let juegoEspecial = document.querySelector("#especialJuego");
        let setNombreEspecial = new Set();

        let setjuegoEspecial = new Set();
        nombreEspecial.innerHTML = nombreEspecial.innerHTML = `<option value="null">Seleccionar</option>`
        for(let i = 0;i<response.length;i++){
            setNombreEspecial.add(response[i].nombreEspecial);
            setjuegoEspecial.add(response[i].juegoEspecial);
        }
        for(let val of setjuegoEspecial){
            juegoEspecial.innerHTML+= `<option value = "${val}">${val}</option>`
        }
        for(let val of setNombreEspecial){
            nombreEspecial.innerHTML+= `<option value = "${val}">${val}</option>`
        }
    }
    function Seleccionar2Especial(el) {
        $.ajax({
            url:"/seleccionarEspecial",
            method:"POST",
            dataType:"json",
            data:{"parametar":el.id,"val":el.value},
            success:function (response) {
                let select = el.id == "nombreEspecial" ? document.querySelector("#especialNombre"):document.querySelector("#especialJuego");
                select.innerHTML = `<option value="null">Selecciona</option>`;
                for(let i = 0;i<response.length;i++){
                    select.innerHTML+=`<option value = "${response[i]}">${response[i]}</option>`
                }
            }
        })
    }
    function ActualizarTodoEspecial(){
        $.ajax({
            url:"/especials",
            method:"POST",
            dataType:"json",
            success:function (response) {
                DisplayEspecial(response);
                SeleccionarEspecial(response);
            }
        });
    }
    ActualizarTodoEspecial();
</script>

</body>
</html>